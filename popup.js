document.addEventListener("DOMContentLoaded",(()=>{const e={toggleExtension:document.getElementById("toggleExtension"),modeSelector:document.querySelector(".mode-selector"),classicModeBtn:document.querySelector('.mode-option[data-mode="classic"]'),advancedModeBtn:document.querySelector('.mode-option[data-mode="advanced"]'),classicSections:document.getElementById("classic-sections"),advancedSections:document.getElementById("advanced-sections"),statusIndicator:document.querySelector(".status-indicator"),statusBadgeText:document.querySelector(".status-badge span:last-child"),countdownDisplay:document.querySelector(".countdown-display"),countdownTime:document.querySelector(".countdown-time"),classicUrls:document.getElementById("classicUrls"),classicMinInterval:document.getElementById("classicMinInterval"),classicMaxInterval:document.getElementById("classicMaxInterval"),addCurrentUrlClassic:document.getElementById("addCurrentUrlClassic"),urlCardContainer:document.getElementById("url-card-container"),addCurrentUrlIndividual:document.getElementById("addCurrentUrlIndividual"),addNewCardBtn:document.getElementById("addNewCardBtn"),advancedMaxActions:document.getElementById("advancedMaxActions"),advancedStartTime:document.getElementById("advancedStartTime"),advancedEndTime:document.getElementById("advancedEndTime"),checkboxes:{classicOnlyPinned:document.querySelector('[data-checkbox-id="classicOnlyPinned"] .checkbox'),advancedPauseOnActive:document.querySelector('[data-checkbox-id="advancedPauseOnActive"] .checkbox'),advancedOnlyPinned:document.querySelector('[data-checkbox-id="advancedOnlyPinned"] .checkbox'),advancedAutoPin:document.querySelector('[data-checkbox-id="advancedAutoPin"] .checkbox'),advancedUnpinOnDisable:document.querySelector('[data-checkbox-id="advancedUnpinOnDisable"] .checkbox'),advancedEnableLimits:document.querySelector('[data-checkbox-id="advancedEnableLimits"] .checkbox'),advancedEnableSchedule:document.querySelector('[data-checkbox-id="advancedEnableSchedule"] .checkbox'),advancedShowStats:document.querySelector('[data-checkbox-id="advancedShowStats"] .checkbox')},dailyLimitsSection:document.getElementById("daily-limits"),timeScheduleSection:document.getElementById("time-schedule"),statisticsSection:document.getElementById("statistics"),dailyProgressContainer:document.getElementById("dailyProgressContainer"),statsTotalActions:document.getElementById("statsTotalActions"),statsActiveUrls:document.getElementById("statsActiveUrls"),statsActiveTime:document.getElementById("statsActiveTime"),progressValueActions:document.getElementById("progressValueActions"),progressFillActions:document.getElementById("progressFillActions"),saveButton:document.getElementById("saveButton"),resetButton:document.getElementById("resetButton"),statusOverlay:document.getElementById("statusOverlay"),statusIcon:document.getElementById("statusIcon"),statusTitle:document.getElementById("statusTitle"),statusText:document.getElementById("statusText"),confirmationModal:document.getElementById("confirmationModal"),confirmationIcon:document.getElementById("confirmationIcon"),confirmationTitle:document.getElementById("confirmationTitle"),confirmationMessage:document.getElementById("confirmationMessage"),confirmActionButton:document.getElementById("confirmAction"),cancelConfirmButton:document.getElementById("cancelConfirm")},t={isEnabled:!1,mode:"classic",classic:{urls:"",minInterval:30,maxInterval:120,onlyPinned:!1},advanced:{individualUrls:[{id:Date.now(),url:"https://www.google.com",minInterval:30,maxInterval:120,isActive:!0,hasRandomPool:!1,randomPoolUrls:"",hasClickPath:!1,clickPathUrls:""}],pauseOnActive:!1,onlyPinned:!1,autoPin:!1,unpinOnDisable:!1,enableLimits:!1,maxActions:500,enableSchedule:!1,startTime:"09:00",endTime:"17:00",showStats:!1}};let a=JSON.parse(JSON.stringify(t)),n=null;function s(e){const t=[];e.hasRandomPool&&t.push("pool-active"),e.hasClickPath&&t.push("click-path-active");const a=e.hasRandomPool,n=e.hasClickPath,s=e.hasRandomPool?"Pool Active":"Pool Inactive",c=e.hasClickPath,i=e.hasRandomPool,o=e.hasClickPath?"Path Active":"Path Inactive";return`\n            <div class="url-card ${t.join(" ")}" data-id="${e.id}">\n                <div class="url-card-header">\n                    <input type="text" class="input-field url-input" placeholder="Enter starting URL for this path" value="${e.url}">\n                    <button class="remove-btn">&times;</button>\n                </div>\n                <div class="url-card-body">\n                    <div class="interval-inputs-container">\n                        <div class="interval-group">\n                            <label class="input-label">Min (sec)</label>\n                            <input type="number" class="input-field interval-input" value="${e.minInterval}" min="5" max="86400">\n                        </div>\n                        <div class="interval-group">\n                            <label class="input-label">Max (sec)</label>\n                            <input type="number" class="input-field interval-input" value="${e.maxInterval}" min="5" max="86400">\n                        </div>\n                    </div>\n                    <div class="card-actions-container">\n                        <div class="pool-control ${a?"active":""} ${n?"muted":""}" title="Toggle Random URL Pool">\n                            <span class="pool-control-icon">üé≤</span>\n                            <span class="pool-control-label">${s}</span>\n                        </div>\n                        <div class="click-path-control ${c?"active":""} ${i?"muted":""}" title="Toggle Click Path">\n                            <span class="click-path-control-icon">üó∫Ô∏è</span>\n                            <span class="click-path-control-label">${o}</span>\n                        </div>\n                        <div class="status-control">\n                            <div class="status-toggle ${e.isActive?"active":"paused"}"></div>\n                            <span class="status-label">${e.isActive?"Active":"Paused"}</span>\n                        </div>\n                    </div>\n                </div>\n                <textarea class="input-field random-pool-textarea" placeholder="Enter one random URL per line.">${e.randomPoolUrls}</textarea>\n                <textarea class="input-field click-path-textarea" placeholder="Enter target URLs to follow (one per line). The extension will click a link on the page that matches one of these URLs.">${e.clickPathUrls}</textarea>\n            </div>\n        `}function c(){e.urlCardContainer.innerHTML=a.advanced.individualUrls.map(s).join("")}function i(t){a=JSON.parse(JSON.stringify(t)),e.toggleExtension.classList.toggle("active",a.isEnabled);const n="classic"===a.mode;e.classicModeBtn.classList.toggle("active",n),e.advancedModeBtn.classList.toggle("active",!n),e.classicSections.style.display=n?"block":"none",e.advancedSections.style.display=n?"none":"block",e.countdownDisplay.style.display=a.isEnabled?"block":"none",e.classicUrls.value=a.classic.urls,e.classicMinInterval.value=a.classic.minInterval,e.classicMaxInterval.value=a.classic.maxInterval,e.checkboxes.classicOnlyPinned.classList.toggle("checked",a.classic.onlyPinned),c(),e.checkboxes.advancedPauseOnActive.classList.toggle("checked",a.advanced.pauseOnActive),e.checkboxes.advancedOnlyPinned.classList.toggle("checked",a.advanced.onlyPinned),e.checkboxes.advancedAutoPin.classList.toggle("checked",a.advanced.autoPin),e.checkboxes.advancedUnpinOnDisable.classList.toggle("checked",a.advanced.unpinOnDisable),e.advancedMaxActions.value=a.advanced.maxActions,e.advancedStartTime.value=a.advanced.startTime,e.advancedEndTime.value=a.advanced.endTime,e.checkboxes.advancedEnableLimits.classList.toggle("checked",a.advanced.enableLimits),l(e.dailyLimitsSection,a.advanced.enableLimits),e.dailyProgressContainer.style.display=a.advanced.enableLimits?"block":"none",e.checkboxes.advancedEnableSchedule.classList.toggle("checked",a.advanced.enableSchedule),l(e.timeScheduleSection,a.advanced.enableSchedule),e.checkboxes.advancedShowStats.classList.toggle("checked",a.advanced.showStats),l(e.statisticsSection,a.advanced.showStats)}function o(t={},a){const n=t[(new Date).toISOString().slice(0,10)]||{totalActions:0,activeUrls:0,activeTime:0},s=Math.floor(n.activeTime/60),c=n.activeTime%60;if(e.statsTotalActions.textContent=n.totalActions,e.statsActiveUrls.textContent=n.activeUrls,e.statsActiveTime.textContent=`${s}h ${c}m`,a.advanced.enableLimits){const t=a.advanced.maxActions,s=Math.min(100,t>0?n.totalActions/t*100:0);e.progressValueActions.textContent=`${n.totalActions} / ${t} (${Math.round(s)}%)`,e.progressFillActions.style.width=`${s}%`}}function l(e,t){e.classList.toggle("show",t)}function d(){const t=(a.classic.urls=e.classicUrls.value,a.classic.minInterval=parseInt(e.classicMinInterval.value),a.classic.maxInterval=parseInt(e.classicMaxInterval.value),a.classic.onlyPinned=e.checkboxes.classicOnlyPinned.classList.contains("checked"),a.advanced.pauseOnActive=e.checkboxes.advancedPauseOnActive.classList.contains("checked"),a.advanced.onlyPinned=e.checkboxes.advancedOnlyPinned.classList.contains("checked"),a.advanced.autoPin=e.checkboxes.advancedAutoPin.classList.contains("checked"),a.advanced.unpinOnDisable=e.checkboxes.advancedUnpinOnDisable.classList.contains("checked"),a.advanced.enableLimits=e.checkboxes.advancedEnableLimits.classList.contains("checked"),a.advanced.maxActions=parseInt(e.advancedMaxActions.value),a.advanced.enableSchedule=e.checkboxes.advancedEnableSchedule.classList.contains("checked"),a.advanced.startTime=e.advancedStartTime.value,a.advanced.endTime=e.advancedEndTime.value,a.advanced.showStats=e.checkboxes.advancedShowStats.classList.contains("checked"),a);chrome.storage.local.set({settings:t},(()=>{chrome.runtime.sendMessage({action:"settingsUpdated"}),u("‚úÖ","Settings Saved!","Your configuration has been successfully applied."),a=JSON.parse(JSON.stringify(t))}))}function r(t){const n=a.isEnabled;if(n&&null!==t&&t>=0){const a=t%60,n=`${Math.floor(t/60).toString().padStart(2,"0")}:${a.toString().padStart(2,"0")}`;e.countdownTime.textContent=n,e.statusIndicator.className="status-indicator status-active",e.statusBadgeText.textContent=`Next: ${t}s`,e.countdownDisplay.style.display="block"}else n?(e.countdownDisplay.style.display="none",e.statusIndicator.className="status-indicator status-active",e.statusBadgeText.textContent="..."):(e.countdownDisplay.style.display="none",e.countdownTime.textContent="--:--",e.statusIndicator.className="status-indicator status-inactive",e.statusBadgeText.textContent="Disabled")}function u(t,a,n){e.statusIcon.textContent=t,e.statusTitle.textContent=a,e.statusText.textContent=n,e.statusOverlay.classList.add("show"),setTimeout((()=>e.statusOverlay.classList.remove("show")),2e3)}function m(t){n=t,"save"===t?(e.confirmationIcon.textContent="üíæ",e.confirmationTitle.textContent="Save Settings?",e.confirmationMessage.textContent="This will apply all changes and restart the refresh timers.",e.confirmActionButton.textContent="Save"):"reset"===t&&(e.confirmationIcon.textContent="üîÑ",e.confirmationTitle.textContent="Reset Everything?",e.confirmationMessage.textContent="This will restore all settings to default and clear all statistics. This cannot be undone.",e.confirmActionButton.textContent="Reset"),e.confirmationModal.classList.add("show")}function v(){e.confirmationModal.classList.remove("show")}e.toggleExtension.addEventListener("click",(()=>{a.isEnabled=!a.isEnabled,e.toggleExtension.classList.toggle("active",a.isEnabled)})),e.modeSelector.addEventListener("click",(e=>{const t=e.target.closest(".mode-option");t&&(a.mode=t.dataset.mode,i(a))})),document.querySelector(".content").addEventListener("click",(t=>{const a=t.target.closest(".checkbox-container");if(a){const t=a.querySelector(".checkbox");t.classList.toggle("checked");const n=t.classList.contains("checked"),s=a.dataset.checkboxId;"advancedEnableLimits"===s&&l(e.dailyLimitsSection,n),"advancedEnableSchedule"===s&&l(e.timeScheduleSection,n),"advancedShowStats"===s&&l(e.statisticsSection,n)}})),e.addCurrentUrlClassic.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!0},(t=>{if(t[0]&&t[0].url&&!t[0].url.startsWith("chrome://")){const a=e.classicUrls.value.trim();e.classicUrls.value=a?`${a}\n${t[0].url}`:t[0].url}}))})),e.addNewCardBtn.addEventListener("click",(()=>{a.advanced.individualUrls.push({id:Date.now(),url:"",minInterval:30,maxInterval:120,isActive:!0,hasRandomPool:!1,randomPoolUrls:"",hasClickPath:!1,clickPathUrls:""}),c()})),e.addCurrentUrlIndividual.addEventListener("click",(()=>{chrome.tabs.query({active:!0,currentWindow:!0},(e=>{e[0]&&e[0].url&&!e[0].url.startsWith("chrome://")&&(a.advanced.individualUrls.push({id:Date.now(),url:e[0].url,minInterval:30,maxInterval:120,isActive:!0,hasRandomPool:!1,randomPoolUrls:"",hasClickPath:!1,clickPathUrls:""}),c())}))})),e.urlCardContainer.addEventListener("input",(e=>{const t=e.target.closest(".url-card");if(!t)return;const n=parseInt(t.dataset.id,10),s=a.advanced.individualUrls.find((e=>e.id===n));if(s)if(e.target.classList.contains("url-input"))s.url=e.target.value;else if(e.target.classList.contains("interval-input")){const e=Array.from(t.querySelectorAll(".interval-input"));s.minInterval=parseInt(e[0].value)||5,s.maxInterval=parseInt(e[1].value)||10}else e.target.classList.contains("random-pool-textarea")?s.randomPoolUrls=e.target.value:e.target.classList.contains("click-path-textarea")&&(s.clickPathUrls=e.target.value)})),e.urlCardContainer.addEventListener("click",(e=>{const t=e.target.closest(".url-card");if(!t)return;const n=parseInt(t.dataset.id,10),s=a.advanced.individualUrls.find((e=>e.id===n));s&&(e.target.closest(".remove-btn")?a.advanced.individualUrls.length>1?(a.advanced.individualUrls=a.advanced.individualUrls.filter((e=>e.id!==n)),c()):u("‚ö†Ô∏è","Cannot Remove","You must have at least one URL entry."):e.target.closest(".status-control")?(s.isActive=!s.isActive,c()):e.target.closest(".pool-control")&&!e.target.closest(".pool-control.muted")?(s.hasRandomPool=!s.hasRandomPool,s.hasRandomPool&&(s.hasClickPath=!1),c()):e.target.closest(".click-path-control")&&!e.target.closest(".click-path-control.muted")&&(s.hasClickPath=!s.hasClickPath,s.hasClickPath&&(s.hasRandomPool=!1),c()))})),e.saveButton.addEventListener("click",(()=>m("save"))),e.resetButton.addEventListener("click",(()=>m("reset"))),e.confirmActionButton.addEventListener("click",(()=>{"save"===n&&d(),"reset"===n&&chrome.storage.local.set({settings:t,stats:{}},(()=>{chrome.runtime.sendMessage({action:"settingsUpdated"}),i(t),o({},t),u("üîÑ","Reset Complete","All settings and statistics have been cleared.")})),v()})),e.cancelConfirmButton.addEventListener("click",v),chrome.storage.onChanged.addListener((e=>{e.countdown&&r(e.countdown.newValue),(e.stats||e.settings)&&chrome.storage.local.get({settings:a,stats:{}},(({settings:t,stats:a})=>{e.stats&&o(a,t)}))})),chrome.storage.local.get({settings:t,stats:{}},(({settings:e,stats:t})=>{i(e),o(t,e)})),chrome.storage.local.get({countdown:null},(({countdown:e})=>r(e))),document.getElementById("year").textContent=(new Date).getFullYear()}));